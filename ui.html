<style>
  @import url('https://fonts.googleapis.com/css?family=Poppins:400,700,900');

  body {
    font-family: 'Poppins';
    background: white !important;
    margin: 0;
    padding: 1em;
    /* width: 100%; */
  }

  .installation-title {
    margin-top: 0px;
    margin-bottom: 10px;
    font-size: 22px;
  }

  .buttons-container {
    margin-top: 1em;
    display: flex;  
    flex-wrap: wrap;
    gap: 18px;
    height: 50px;
    align-items: stretch;
    justify-content: center;
  }

  .btn {
    font-family: 'Poppins';
    padding: 10px;
    border: 0;
    background: none;
    box-shadow: none;
    font-size: 12px;
  }

  .btn-success {
    color: white;
    background: #1BC5BD !important;
    border-radius: 5px;
    width: 180px; 
  }

  .btn-primary {
    color: white;
    background: #007bff !important;
    border-radius: 5px;
    width: 180px; 
  }

  .btn-warning {
    color: white;
    background: #ffc107 !important;
    border-radius: 5px;
    width: 180px; 
  }

  .btn-cancel {
    color: white;
    background: #4A4A4A;
    border-radius: 5px;
    width: 180px; 
  }

  .btn:hover {
    /* opacity: 0.8; */
    filter: brightness(85%);
  }

  .sub-label {
    color: #80808F;
    font-family: 'Poppins';
    font-size: 12px;
    /* margin-bottom: 2em; */
  }
  
  .tab-deets {
    font-family: 'Poppins';
    color: white;
    text-align: center;
    width: 100px;
    padding: 10px;
    border: 0;
    background: none;
    box-shadow: none;
    font-size: 12px;
  }

  .display-code-container { position: relative}

  .btn-copy {
    font-family: 'Poppins';
    color: white;
    text-align: center;
    width: 40px;
    padding: 10px;
    border: 0;
    border-radius: 10px;
    background: none;
    box-shadow: none;
    font-size: 12px;
    background: #444444;;
    position:absolute;
    right:20;
    z-index: 10;
  }

  .copy-code-icon {
    height: 15px;
  }

  .tab-main {
    margin-bottom: 1em;
  }

  .tab-1 {
    background: #444444;
  }

  .tab-2{
    background: #606D71;
  }

  .tab-display-txt {
    width: 420px;
    padding: 10px;
    background: #F3F5F9;
    margin-bottom: 1.5em;
    height: 37vh;
    overflow: auto;
  }

  .tab-display {
    width: 350px;
    padding: 2em;
    background: #F3F5F9;
    margin-bottom: 1.5em;
    height: 37vh;
    overflow: auto;
  }

  .tab-display-info {
    width: 100%;
    padding: 1em;
    background: #F3F5F9;
    margin-bottom: 1em;
    height: 300px;
    overflow: auto;
  }

  .info-style {
    max-width: 360px;
    margin-left: auto;
    margin-right: auto;
    white-space: normal;
  }

  .tab-deets:disabled, .btn:disabled {
    opacity: 0.8 !important;
  }

  /* #outer{
    width:100%;
    text-align: center;
  } */

  .inner{
    display: inline-block;
  }

  .mb-2 { margin-bottom: 1em;}

  .tab-column {float: left;}
  .tab-row:after {
    content: "";
    display: table;
    clear: both;
  }

  
  .lds-grid {
    display: inline-block;
    position: relative;
    width: 80px;
    height: 80px;
  }
  .lds-grid div {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #4A4A4A;
    animation: lds-grid 1.2s linear infinite;
  }
  .lds-grid div:nth-child(1) {
    top: 8px;
    left: 8px;
    animation-delay: 0s;
  }
  .lds-grid div:nth-child(2) {
    top: 8px;
    left: 32px;
    animation-delay: -0.4s;
  }
  .lds-grid div:nth-child(3) {
    top: 8px;
    left: 56px;
    animation-delay: -0.8s;
  }
  .lds-grid div:nth-child(4) {
    top: 32px;
    left: 8px;
    animation-delay: -0.4s;
  }
  .lds-grid div:nth-child(5) {
    top: 32px;
    left: 32px;
    animation-delay: -0.8s;
  }
  .lds-grid div:nth-child(6) {
    top: 32px;
    left: 56px;
    animation-delay: -1.2s;
  }
  .lds-grid div:nth-child(7) {
    top: 56px;
    left: 8px;
    animation-delay: -0.8s;
  }
  .lds-grid div:nth-child(8) {
    top: 56px;
    left: 32px;
    animation-delay: -1.2s;
  }
  .lds-grid div:nth-child(9) {
    top: 56px;
    left: 56px;
    animation-delay: -1.6s;
  }
  @keyframes lds-grid {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  .loading-container {
    width: 100%;
    height: 37vh;
    flex-direction: column;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* The snackbar - position it at the bottom and in the middle of the screen */
  #snackbar {
    visibility: hidden; /* Hidden by default. Visible on click */
    min-width: 250px; /* Set a default minimum width */
    max-width: 250px;
    margin-left: -125px; /* Divide value of min-width by 2 */
    background-color: #333; /* Black background color */
    color: #fff; /* White text color */
    text-align: center; /* Centered text */
    border-radius: 2px; /* Rounded borders */
    padding: 16px; /* Padding */
    position: fixed; /* Sit on top of the screen */
    z-index: 1; /* Add a z-index if needed */
    left: 50%; /* Center the snackbar */
    bottom: 30px; /* 30px from the bottom */
  }

  /* Show the snackbar when clicking on a button (class added with JavaScript) */
  #snackbar.show {
    visibility: visible; /* Show the snackbar */
    /* Add animation: Take 0.5 seconds to fade in and out the snackbar.
    However, delay the fade out process for 2.5 seconds */
    -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
  }

  /* Animations to fade the snackbar in and out */
  @-webkit-keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
  }

  @keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
  }

  @-webkit-keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
  }

  @keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
  }

  .mr-connect { margin-left: 9px}
  .mb-subtitle { margin-bottom: 10px}

  input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

div#angularNote {
  font-size: 9px;
  margin-top: -11px;
  margin-bottom: 6px;
  color: gray;
  /* font-style: italic; */
}

.th{
  /* Th */
box-sizing: border-box;

/* Auto layout */

display: flex;
flex-direction: row;
justify-content: space-between;
align-items: center;
padding: 9px 0px;

width: 217px;
height: 60px;

/* Background/FFFFFF */

background: #FFFFFF;
/* Greys / Grey 6 #D6D6E0 */

border-bottom: 5px solid #D6D6E0;

/* Inside auto layout */

flex: none;
order: 0;
align-self: stretch;
flex-grow: 0;
}
</style>

<!--importing file saver-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.js"></script>
<!--importing jszip-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.9.1/jszip.min.js" type="text/javascript"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.js" type="text/javascript"> </script>
<!--importing code mirror-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<!--importing clipboard-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
<!--importing code mirror-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" />
<!--jquery-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<!--importing bootstrap-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<div id="flutter-code-generator">
  <div>
    <h3 style="margin-bottom: 0; margin-top: 5px;">Flutter Code Generator</h3>
    <div class="sub-label" style="margin-bottom: 5px; margin-top: 5px;">Kindly select the frame or framesList to be generated and select the type of UI.</div>
    <!---->
    <select class="form-control" id="ui-type" style="margin-bottom: 10px">
      <option value="screen">Screen</option>
      <option value="dialog">Dialog</option>
      <option value="modal">Modal</option>
      <option value="pageview">Pageview</option>
      <option value="tabs">TabBar(Inside AppBar)</option>
      <option value="widget">Widget</option>
      <option value="stateless">Stateless</option>
    </select>
    <!---->
    <div class="tab-main" id="tab-container">
      <div class="tab-row">
      <button class="tab-deets tab-column tab-1" id="preview">Preview</button>
    </div>
    </div>
    <!---->
    <div id="loading" class="loading-container" style="display: none;" >
      <div class="lds-grid"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
      <h4 style="margin-bottom: 0;">Generating Code Please Wait...</h4>
    </div>
    <!---->
    <div class="display-code-container" id="display-code">
      <button id="btnCopy" class="btn-copy" type="button" tooltip="">
        <img class="copy-code-icon" src="https://img.icons8.com/material-outlined/48/FFFFFF/copy"/>
      </button>
      <textarea id="displayFlutter" disabled="true" class="tab-display-txt" style="border: none; resize: none;"></textarea>
    </div>
  </div>
  
  <div id="buttons-container" class="buttons-container">
    <div class="inner">
      <button class="btn btn-success btn-dl" id="download">Download</button>
    </div>
    <div class="inner">
      <button class="btn btn-success" id="create">Generate Code</button>
    </div>
    <div class="inner" >
      <button class="btn btn-cancel" id="cancel">Cancel</button>
    </div>
  </div>
</div>




<!-- The actual snackbar -->
<div id="snackbar">Some text some message..</div>

<script>
  var cm;
  var firstGeneration = true;
  var framesList = [];
  init()

  onmessage = (event) => {
    if(event.data.pluginMessage.type == 'generated-flutter'){
      uiChanges(event.data.pluginMessage.hidePreview,event.data.pluginMessage.hideInstruction);
      if(event.data.pluginMessage.message != "Kindly select a frame to be generated"){
        firstGeneration = false;
      }else{
        firstGeneration = true;
      }
    }

    if(event.data.pluginMessage.type == 'preview'){
      //hide the other element
      document.getElementById("create").disabled = false;
      document.getElementById("download").disabled = false;
      cm.getWrapperElement().style.display = "block";

      document.getElementById("display-code").style.display = 'block';
      document.getElementById("display-code").style.visibility = 'visible';
      document.getElementById("btnCopy").style.visibility = 'visible';
      document.getElementById("buttons-container").style.marginTop= '1em';
      cm.setValue(event.data.pluginMessage.code[0].code);
      cm.refresh();
    }

    if(event.data.pluginMessage.type == 'download'){
      var codes = event.data.pluginMessage.code;
      var imagesAndSvg = event.data.pluginMessage.imagesAndSvg;
      var pageImage = event.data.pluginMessage.pageImage;
      var pageJson = event.data.pluginMessage.pageJson;


      if( document.getElementById("display-code").style.display === 'block' ){

        document.getElementById("buttons-container").style.marginTop= '1em';
        }else{
          document.getElementById("buttons-container").style.marginTop= '48vh';
          if(document.getElementById("tab-container").style.display == 'none'){
            document.getElementById("buttons-container").style.marginTop = '55vh';
          }
        }

      download("GeneratedCode", codes, imagesAndSvg, pageImage, pageJson);
      return;
    }

    if(event.data.pluginMessage.type == 'error'){
      document.getElementById("create").disabled = false;
      document.getElementById("loading").style.display = 'none';

      document.getElementById("btnCopy").style.visibility = 'hidden';
      if(event.data.pluginMessage.message == "Kindly select a frame to be generated"){
        document.getElementById("buttons-container").style.marginTop= '63vh';
      }

      cm.getWrapperElement().style.display = "none";
      displaySnackBar(event.data.pluginMessage.message);
    }
  }

  document.getElementById('create').onclick = () => {

    document.getElementById("create").disabled = true;
    document.getElementById("preview").disabled = true;
    document.getElementById("download").disabled = true;

    document.getElementById("loading").style.display = 'flex';

    document.getElementById("btnCopy").style.display = 'none';

   if(firstGeneration == false){
        if(document.getElementById("preview").style.display == 'none'){
          document.getElementById("buttons-container").style.marginTop= '15vh';
        }
        else{
          document.getElementById("buttons-container").style.marginTop= '10vh';
        }
    }

    if(firstGeneration == true){
      if(document.getElementById("preview").style.display == 'none'){
        document.getElementById("buttons-container").style.marginTop = '25vh';
      }else{
        document.getElementById("buttons-container").style.marginTop= '48vh';
      }
      
    }
    cm.getWrapperElement().style.display = "none";
    setTimeout(function(){ 

      parent.postMessage({ 
      pluginMessage: { type: 'generate-code' } }, '*');
    }, 1000);
  }

  document.getElementById('cancel').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
  }

  document.getElementById('preview').onclick = () => {
    let dropdownControl = document.getElementById("ui-type");
    selectedUiType = dropdownControl.value;
    document.getElementById("create").disabled = true;
    document.getElementById("download").disabled = true;
    document.getElementById('display-code').style.visibility = 'visible';
    document.getElementById('display-code').style.display = 'block';
    document.getElementById("btnCopy").style.visibility = 'visible';
    document.getElementById("btnCopy").style.display = 'block';
    parent.postMessage({ pluginMessage: { type: 'display-preview', uiType: selectedUiType } }, '*')
  }

  document.getElementById('download').onclick = () => {
    let dropdownControl = document.getElementById("ui-type");
    selectedUiType = dropdownControl.value;
    document.getElementById("create").disabled = true;
    document.getElementById("preview").disabled = true;
    parent.postMessage({ pluginMessage: { type: 'download', uiType: selectedUiType } }, '*')
  }


  function download(zipName, codes, imagesAndSvg, pageImage, pageJson) {
    var zip = new JSZip();
    var assetFolder = zip.folder("assets");
    var pageImagesFolder = zip.folder("PageImages");
    var pageJsonFolder = zip.folder("PageJson");
    var dartFolder = zip.folder("Dart");

    pageJsonFolder.file(`all_pages.json`,pageJson);

    codes.forEach(code=>{
      dartFolder.file(`${code.fileName}.dart`,code.code);
    });
    
    pageImage.forEach(data =>{
      let blobData = new Blob([data.vector], {type: "image/png"});
      pageImagesFolder.file(`${data.name}.png`, blobData, {binary:true});
    });

    imagesAndSvg.forEach(data => {
      let imageType = `${data.imageType == 'jpg' ? 'jpeg' : data.imageType}`;
      let blobData = new Blob([data.vector], { type: `image/${imageType}`});
      assetFolder.file(`${data.name}.${imageType}`, blobData, {binary: true});
    });

    zip.generateAsync({
      type: 'blob'
    }).then(function(content) {
      saveAs(content, zipName);
    });
    document.getElementById("create").disabled = false;
    document.getElementById("preview").disabled = false;
  }

  function init(){
    document.getElementById("preview").disabled = true;
    document.getElementById("preview").style.display = 'none';
    document.getElementById("tab-container").style.visibility = 'hidden';
    document.getElementById("tab-container").style.display = 'none';
    document.getElementById("download").style.display = 'none';
    document.getElementById("btnCopy").style.display = 'none';
    document.getElementById("buttons-container").style.marginTop= '65vh';



    cm = CodeMirror.fromTextArea(document.getElementById("displayFlutter"), {
      mode:  "dart",
      indentWithTabs: true,
      smartIndent: true,
      lineNumbers: true,
      lineWrapping: true,
      matchBrackets : true,
      autofocus: true,
      readOnly: true
    });

    new ClipboardJS('#btnCopy', {
      text: function(trigger) {
        displaySnackBar("Saved to clipboard")
        return cm.getValue();
      }
    });

    cm.getWrapperElement().style.display="none";
  }

  function uiChanges(hidePreview,hideInstruction){
    if(hidePreview){
      document.getElementById("preview").disabled = true;
      document.getElementById("preview").style.display = 'none';
      if(hideInstruction){
        document.getElementById("buttons-container").style.marginTop= '55vh';
      } else {
        document.getElementById("buttons-container").style.marginTop= '50vh';
      }
    }
    else{
      document.getElementById("preview").disabled = false;
      document.getElementById("preview").style.display = 'block';
      document.getElementById("buttons-container").style.marginTop= '48vh';
      document.getElementById("tab-container").style.visibility = 'visible';
      document.getElementById("tab-container").style.display = 'block';
    }




    document.getElementById("display-code").style.display = 'none';
    document.getElementById("display-code").style.visibility = 'hidden';

    document.getElementById("buttons-container").style.height = '80px';
    document.getElementById("create").disabled = false;
    document.getElementById("download").disabled = false;
    document.getElementById("download").style.display = 'block';
    document.getElementById("loading").style.display = 'none';
    document.getElementById("download").innerText = `Download`;
  }

  function showUtils(){
    document.getElementById("utils-container").style.display = 'block';
    document.getElementById("flutter-code-generator").style.display = 'none';
  }

  function hideUtils(){
    document.getElementById("utils-container").style.display = 'none';
    document.getElementById("flutter-code-generator").style.display = 'block';
  }

  function showTable(){
    document.getElementById("table-container").style.display = 'block';
    document.getElementById("flutter-code-generator").style.display = 'none';
  }

  function hideTable(){
    document.getElementById("table-container").style.display = 'none';
    document.getElementById("flutter-code-generator").style.display = 'block';
  }

  function showWidgetContainer(){
    document.getElementById("widget-create-container").style.display = 'block';
    document.getElementById("flutter-code-generator").style.display = 'none';
  }

  function hideWidgetContainer(){
    document.getElementById("widget-create-container").style.display = 'none';
    document.getElementById("flutter-code-generator").style.display = 'block';
  }


  function displaySnackBar(message) {
    // Get the snackbar DIV
    var snackbarDiv = document.getElementById("snackbar");
    snackbarDiv.innerHTML = message;

    // Add the "show" class to DIV
    snackbarDiv.className = "show";

    // After 3 seconds, remove the show class from DIV
    setTimeout(function(){ snackbarDiv.className = snackbarDiv.className.replace("show", ""); }, 3000);
  }

</script>
